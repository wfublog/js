var memberSys={};memberSys.t={wait:"請稍待...",welcome:"您好，已成功登入會員",welcomeNewMember:"您好，加入會員後，即可進行加值",loginMember:"請先加入會員，即可進行加值",loginFB:"請先登入 Facebook 即可免費加入會員",error:"目前伺服器忙碌中，請稍後再試、或重新整理頁面！"};memberSys.gif="<img style='vertical-align: middle;' src='https://lh5.googleusercontent.com/-EyVZ0f8J0qQ/UCeEG7aa8nI/AAAAAAAADtY/9sXw53XkYXM/s512/indicator-light.gif'/> ";memberSys.postUrl="http://"+location.hostname+location.pathname;memberSys.info={};memberSys.json={};memberSys.history=location.href;memberSys.gif="<img style='vertical-align: middle;' src='https://lh5.googleusercontent.com/-EyVZ0f8J0qQ/UCeEG7aa8nI/AAAAAAAADtY/9sXw53XkYXM/s512/indicator-light.gif'/> ";memberSys.statusChangeCB=function(a){memberSys.response=a;(function(c,g){var d=c.response,k="https://script.google.com/macros/s/AKfycbyNqokvD7-b7DeyeoZLsJAbywlTEdN5unlegZ78hCg0Czh5jbo/exec",f="https://script.google.com/macros/s/AKfycbxfvFBrc6kN58sCBsR_axbeeAV-h4KLr76q2uPZnIryLveK3Y8/exec",j="wm";function e(n){var o=c.info,m=n.name,p=c.postUrl,l=n.point;c.json=n;if(!m){g("#member_message").html(o.name+" "+c.t.welcomeNewMember);g("#member_signUp").show()}else{g("#member_message").html(o.name+" "+c.t.welcome);g("#member_signUp").hide();g("#post_point_message").show();g(".member_point_value").html(l);g.ajax({type:"GET",dataType:"jsonp",jsonpCallback:"aa",data:{method:"queryPoint",postUrl:p,queryID:n.id},url:f,success:function(q){b(q)}})}}function b(n){var p=c.json.item,l=n.point,o=n.item,m="";if(p.indexOf(o)==-1){m+="<span>本文需要點數：</span>"+l+" ";m+="<span class='inlineBlock'><span id='member_buyNow_btn' class='buttonBlue buttonAll'>立即兌換 💰</span>";m+="<span id='member_buyNow_manual' class='buttonBlue buttonAll'>加值說明 📖</span></span>";g("#member_value_body").addClass("member_value_body").html(m).show();if(l==0){if(c.json.level!="加值會員"){g("#member_buyNow_btn").remove()}g(".member_limit").html("<< 以下加值內容，僅供本站客戶、或加值會員兌換！ >>")}g("#member_buyNow_btn").click(function(){i(l,o)});g("#member_buyNow_manual").click(function(){window.open("http://www.wfublog.com/2015/01/member-buynow-instruction.html","_blank")})}else{h(o)}}function i(l,n){var m=c.json.point,o=c.json.id;if(m>=l){if(confirm("將扣除您的點數 "+l+" 點，是否確認？ ")){g("#member_value_body").html(c.gif+c.t.wait);g.ajax({type:"GET",dataType:"jsonp",jsonpCallback:"aa",data:{method:"buyPost",itemNo:n,queryID:o},url:f,success:function(p){g("#member_value_body").removeClass("member_value_body").html(unescape(p))},error:function(p){console.log(p);alert(c.t.error)}})}}else{alert("您的點數不足！")}}function h(l){var m=c.json.id;g.ajax({type:"GET",dataType:"jsonp",jsonpCallback:"aa",data:{method:"queryPost",queryID:m,itemNo:l},url:f,success:function(n){g("#member_value_content").html(unescape(n));g("#member_value_body").show()}})}if(d.status==="connected"){memberSys.fbLogout();FB.api("/me",function(l){c.info=l;var m=l.id;if(!m){g("#member_message").html(c.t.error);return}g("#member_icon").attr("src","http://graph.facebook.com/"+m+"/picture").show();g.ajax({type:"GET",dataType:"jsonp",jsonpCallback:"aa",data:{method:"queryMember",query:m},url:k,success:function(n){e(n)}})})}else{if(d.status==="not_authorized"){memberSys.fbLogout();g("#member_message").html(c.t.loginMember);g("#member_signUp").show()}else{memberSys.fbLogin();g("#member_message").html(c.t.loginFB)}}})(memberSys,jQuery)};memberSys.checkLoginState=function(){FB.getLoginStatus(function(a){memberSys.statusChangeCB(a)})};memberSys.fbLogin=function(){$(".fb_logout").hide();$(".fb_login").show()};memberSys.fbLogout=function(){$(".fb_login").hide();$(".fb_logout").show()};$(document).on("click",".fb_login",function(){FB.login(function(a){FB.getLoginStatus(function(b){memberSys.statusChangeCB(b)})},{scope:"public_profile,email"})});$(document).on("click",".fb_logout",function(){FB.logout(function(a){location.reload()})});