var memberSys={t:{wait:"請稍待...",welcome:"您好，已成功登入會員",welcomeNewMember:"您好，加入會員後，即可進行加值",loginMember:"請先加入會員，即可進行加值",loginFB:"請先登入 Facebook 即可免費加入會員",error:"目前伺服器忙碌中，請稍後再試、或重新整理頁面！"},gif:"<img style='vertical-align: middle;' src='https://lh5.googleusercontent.com/-EyVZ0f8J0qQ/UCeEG7aa8nI/AAAAAAAADtY/9sXw53XkYXM/s512/indicator-light.gif'/> "};memberSys.postUrl="//"+location.hostname+location.pathname,memberSys.info={},memberSys.json={},memberSys.history=location.href,memberSys.gif="<img style='vertical-align: middle;' src='https://lh5.googleusercontent.com/-EyVZ0f8J0qQ/UCeEG7aa8nI/AAAAAAAADtY/9sXw53XkYXM/s512/indicator-light.gif'/> ",memberSys.statusChangeCB=function(e){memberSys.response=e,function(e,o){var t=e.response,n="https://script.google.com/macros/s/AKfycbwHxjIXZrBkujcPpRKj9dopTO5SSQKsXsXA12ADUgbhdW96ryI/exec",m="https://script.google.com/macros/s/AKfycbxfvFBrc6kN58sCBsR_axbeeAV-h4KLr76q2uPZnIryLveK3Y8/exec";function s(t){var n=e.info,s=t.name,i=e.postUrl,a=t.point;e.json=t,s?(o("#member_message").html(n.name+" "+e.t.welcome),o("#member_signUp").hide(),o("#post_point_message").show(),o(".member_point_value").html(a),o.ajax({type:"GET",data:{method:"queryPoint",postUrl:i,queryID:t.id},url:m,success:function(e){r(JSON.parse(e))}})):(o("#member_message").html(n.name+" "+e.t.welcomeNewMember),o("#member_signUp").show())}function r(t){var n=e.json.item,m=parseInt(t.point),s=t.item,r="";-1==n.indexOf(s)?(r+="<span>本文需要點數：</span>"+m+" ",r+="<span class='inlineBlock'><span id='member_buyNow_btn' class='buttonBlue buttonAll'>立即兌換 💰</span>",r+="<span id='member_buyNow_manual' class='buttonBlue buttonAll'>加值說明 📖</span></span>",o("#member_value_body").addClass("member_value_body").html(r).show(),0==m&&("加值會員"!=e.json.level&&o("#member_buyNow_btn").remove(),o(".member_limit").html("<< 以下加值內容，僅供本站客戶、或加值會員兌換！ >>")),o("#member_buyNow_btn").click(function(){i(m,s)}),o("#member_buyNow_manual").click(function(){window.open("//www.wfublog.com/2015/01/member-buynow-instruction.html","_blank")})):a(s)}function i(t,n){var s=parseInt(e.json.point),r=e.json.id;s>=t?confirm("將扣除您的點數 "+t+" 點，是否確認？ ")&&(o("#member_value_body").html(e.gif+e.t.wait),o.ajax({type:"GET",data:{method:"buyPost",itemNo:n,queryID:r},url:m,success:function(e){o("#member_value_body").removeClass("member_value_body").html(decodeURIComponent(e))},error:function(o){console.log(o),alert(e.t.error)}})):alert("您的點數不足！")}function a(t){var n=e.json.id;o.ajax({type:"GET",data:{method:"queryPost",queryID:n,itemNo:t},url:m,success:function(e){o("#member_value_content").html(decodeURIComponent(e)),o("#member_value_body").show()}})}"connected"===t.status?(memberSys.fbLogout(),FB.api("/me",function(t){e.info=t;var m=t.id;m?(o("#member_icon").attr("src","//graph.facebook.com/"+m+"/picture").show(),o.ajax({type:"GET",data:{method:"queryMember",query:m},url:n,success:function(e){s(JSON.parse(e))}})):o("#member_message").html(e.t.error)})):"not_authorized"===t.status?(memberSys.fbLogout(),o("#member_message").html(e.t.loginMember),o("#member_signUp").show()):(memberSys.fbLogin(),o("#member_message").html(e.t.loginFB))}(memberSys,jQuery)},memberSys.checkLoginState=function(){FB.getLoginStatus(function(e){memberSys.statusChangeCB(e)})},memberSys.fbLogin=function(){$(".fb_logout").hide(),$(".fb_login").show()},memberSys.fbLogout=function(){$(".fb_login").hide(),$(".fb_logout").show()},$(document).on("click",".fb_login",function(){FB.login(function(e){FB.getLoginStatus(function(e){memberSys.statusChangeCB(e)})},{scope:"public_profile,email"})}),$(document).on("click",".fb_logout",function(){FB.logout(function(e){location.reload()})});